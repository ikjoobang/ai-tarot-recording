/**
 * ğŸ”® íƒ€ë¡œ ìƒë‹´ ì‹œë‚˜ë¦¬ì˜¤ ëª¨ë“ˆ
 * ë‹¤ì–‘í•œ ìƒë‹´ ì‹œë‚˜ë¦¬ì˜¤ì™€ ëŒ€í™” í”Œë¡œìš° ê´€ë¦¬
 */

const TarotScenarios = {
    // ì‹œë‚˜ë¦¬ì˜¤ ë°ì´í„°
    scenarios: {
        love: {
            id: 'love',
            name: 'ì—°ì• ìš´ ìƒë‹´',
            icon: 'ğŸ’•',
            description: 'ì¢‹ì•„í•˜ëŠ” ì‚¬ëŒê³¼ì˜ ë¯¸ë˜, ì—°ì•  ê³ ë¯¼',
            systemPrompt: `ë‹¹ì‹ ì€ íƒ€ë¡œ ìƒë‹´ì„ ë°›ìœ¼ëŸ¬ ì˜¨ 20-30ëŒ€ ì—¬ì„± ì†ë‹˜ì…ë‹ˆë‹¤. 
ìµœê·¼ì— ì¢‹ì•„í•˜ëŠ” ì‚¬ëŒì´ ìƒê²¼ê³ , ê·¸ ì‚¬ëŒê³¼ì˜ ë¯¸ë˜ê°€ ê¶ê¸ˆí•©ë‹ˆë‹¤.
ìì—°ìŠ¤ëŸ½ê³  ì§„ì§€í•˜ê²Œ ê³ ë¯¼ì„ í„¸ì–´ë†“ìœ¼ì„¸ìš”.
íƒ€ë¡œ ê°•ì‚¬ì˜ í•´ì„ì— ê³µê°í•˜ê³  ì¶”ê°€ ì§ˆë¬¸ì„ í•˜ì„¸ìš”.`,
            openingLines: [
                "ì•ˆë…•í•˜ì„¸ìš”, ì—°ì• ìš´ì„ ë´ì£¼ì‹¤ ìˆ˜ ìˆì„ê¹Œìš”?",
                "ìµœê·¼ì— ì¢‹ì•„í•˜ëŠ” ì‚¬ëŒì´ ìƒê²¼ëŠ”ë°ìš”, ê·¸ ì‚¬ëŒê³¼ ì˜ ë  ìˆ˜ ìˆì„ì§€ ê¶ê¸ˆí•´ì„œìš”.",
                "ì œê°€ ë¨¼ì € ë‹¤ê°€ê°€ì•¼ í• ê¹Œìš”, ì•„ë‹ˆë©´ ê¸°ë‹¤ë ¤ì•¼ í• ê¹Œìš”?"
            ],
            followUpQuestions: [
                "ê·¸ë ‡ë‹¤ë©´ ì œê°€ ì–´ë–¤ í–‰ë™ì„ ì·¨í•˜ë©´ ì¢‹ì„ê¹Œìš”?",
                "ì´ ê´€ê³„ê°€ ë°œì „í•  ê°€ëŠ¥ì„±ì´ ìˆì„ê¹Œìš”?",
                "ì œ ë§ˆìŒì„ í‘œí˜„í•˜ê¸°ì— ì¢‹ì€ ì‹œê¸°ëŠ” ì–¸ì œì¼ê¹Œìš”?",
                "ìƒëŒ€ë°©ë„ ì €ì—ê²Œ ê´€ì‹¬ì´ ìˆì„ê¹Œìš”?",
                "ì¡°ì‹¬í•´ì•¼ í•  ì ì´ë‚˜ ì£¼ì˜ì‚¬í•­ì´ ìˆì„ê¹Œìš”?"
            ],
            reactions: [
                "ì•„, ê·¸ë ‡êµ°ìš”. ê·¸ê²Œ ë§ëŠ” ê²ƒ ê°™ì•„ìš”.",
                "ì •ë§ìš”? ê·¸ê±´ ìƒê° ëª»í–ˆì–´ìš”.",
                "ë„¤, ì´í•´í–ˆìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤.",
                "ê·¸ ë¶€ë¶„ì´ íŠ¹íˆ ì™€ë‹¿ë„¤ìš”.",
                "ì œê°€ ëŠê¼ˆë˜ ê²ƒê³¼ ë¹„ìŠ·í•œë°ìš”?"
            ]
        },
        
        wealth: {
            id: 'wealth',
            name: 'ì¬ë¬¼ìš´ ìƒë‹´',
            icon: 'ğŸ’°',
            description: 'ì‚¬ì—…, íˆ¬ì, ì¬ì • ìƒíƒœ',
            systemPrompt: `ë‹¹ì‹ ì€ íƒ€ë¡œ ìƒë‹´ì„ ë°›ìœ¼ëŸ¬ ì˜¨ 30-40ëŒ€ ì‚¬ì—…ê°€ì…ë‹ˆë‹¤.
ìƒˆë¡œìš´ ì‚¬ì—…ì„ ì‹œì‘í•˜ë ¤ê³  í•˜ê±°ë‚˜ íˆ¬ì ê²°ì •ì„ ì•ë‘ê³  ìˆìŠµë‹ˆë‹¤.
ì¬ì •ì  ì•ˆì •ê³¼ ì„±ê³µ ê°€ëŠ¥ì„±ì— ëŒ€í•´ ì•Œê³  ì‹¶ì–´í•©ë‹ˆë‹¤.
í˜„ì‹¤ì ì´ë©´ì„œë„ ì§„ì§€í•œ íƒœë„ë¡œ ìƒë‹´ì— ì„í•˜ì„¸ìš”.`,
            openingLines: [
                "ì•ˆë…•í•˜ì„¸ìš”, ì¬ë¬¼ìš´ì— ëŒ€í•´ ìƒë‹´ë°›ê³  ì‹¶ìŠµë‹ˆë‹¤.",
                "ìš”ì¦˜ ìƒˆë¡œìš´ ì‚¬ì—…ì„ ì¤€ë¹„ ì¤‘ì¸ë°ìš”, ì˜ ë ì§€ ê¶ê¸ˆí•´ì„œìš”.",
                "ì§€ê¸ˆ íˆ¬ì ì œì•ˆì„ ë°›ì•˜ëŠ”ë°, ì–´ë–»ê²Œ í•´ì•¼ í• ì§€ ëª¨ë¥´ê² ì–´ìš”."
            ],
            followUpQuestions: [
                "ì´ ì‚¬ì—…ì´ ì„±ê³µí•  ê°€ëŠ¥ì„±ì€ ì–´ëŠ ì •ë„ì¸ê°€ìš”?",
                "ì¬ì •ì ìœ¼ë¡œ ì•ˆì •ë  ìˆ˜ ìˆì„ê¹Œìš”?",
                "ì§€ê¸ˆ íˆ¬ìí•˜ëŠ” ê²Œ ë§ì„ê¹Œìš”, ì•„ë‹ˆë©´ ê¸°ë‹¤ë ¤ì•¼ í• ê¹Œìš”?",
                "ì£¼ì˜í•´ì•¼ í•  ë¦¬ìŠ¤í¬ê°€ ìˆë‚˜ìš”?",
                "ì–¸ì œì¯¤ ê²°ì‹¤ì„ ë³¼ ìˆ˜ ìˆì„ê¹Œìš”?"
            ],
            reactions: [
                "ê·¸ ë¶€ë¶„ì´ ì œì¼ ê±±ì •ì´ì—ˆì–´ìš”.",
                "ì•„, ê·¸ë ‡ê²Œ í•´ì„ë  ìˆ˜ë„ ìˆêµ°ìš”.",
                "ì¢€ ë” ì‹ ì¤‘í•˜ê²Œ ì ‘ê·¼í•´ì•¼ê² ë„¤ìš”.",
                "ê·¸ê±´ ì˜ˆìƒí•˜ì§€ ëª»í–ˆëŠ”ë°ìš”.",
                "êµ¬ì²´ì ì¸ ì¡°ì–¸ ê°ì‚¬í•©ë‹ˆë‹¤."
            ]
        },
        
        career: {
            id: 'career',
            name: 'ì§„ë¡œ/ì·¨ì—… ìƒë‹´',
            icon: 'ğŸ’¼',
            description: 'ì§ì¥, ì´ì§, ì§„ë¡œ ì„ íƒ',
            systemPrompt: `ë‹¹ì‹ ì€ íƒ€ë¡œ ìƒë‹´ì„ ë°›ìœ¼ëŸ¬ ì˜¨ 20-30ëŒ€ ì§ì¥ì¸ì…ë‹ˆë‹¤.
í˜„ì¬ ì§ì¥ì—ì„œì˜ ê³ ë¯¼ì´ ìˆê±°ë‚˜ ì´ì§ì„ ê³ ë ¤ ì¤‘ì…ë‹ˆë‹¤.
ìƒˆë¡œìš´ ë„ì „ê³¼ ì•ˆì • ì‚¬ì´ì—ì„œ ê³ ë¯¼í•˜ê³  ìˆìŠµë‹ˆë‹¤.
ì§„ë¡œì™€ ê²½ë ¥ ë°œì „ì— ëŒ€í•œ ì¡°ì–¸ì„ êµ¬í•˜ì„¸ìš”.`,
            openingLines: [
                "ì•ˆë…•í•˜ì„¸ìš”, ì§„ë¡œ ê³ ë¯¼ì´ ìˆì–´ì„œ ì™”ìŠµë‹ˆë‹¤.",
                "ì§€ê¸ˆ ì§ì¥ì„ ê·¸ë§Œë‘ê³  ìƒˆë¡œìš´ ê³³ìœ¼ë¡œ ì˜®ê¸¸ê¹Œ ê³ ë¯¼ ì¤‘ì´ì—ìš”.",
                "ì´ì§ ì œì•ˆì„ ë°›ì•˜ëŠ”ë°, ê²°ì •í•˜ê¸°ê°€ ì–´ë µë„¤ìš”."
            ],
            followUpQuestions: [
                "ì§€ê¸ˆ íšŒì‚¬ì— ê³„ì† ë‹¤ë‹ˆëŠ” ê²Œ ë‚˜ì„ê¹Œìš”?",
                "ìƒˆë¡œìš´ ë„ì „ì´ ì €ì—ê²Œ ë§ì„ê¹Œìš”?",
                "ì´ì§ ì‹œê¸°ëŠ” ì–¸ì œê°€ ì¢‹ì„ê¹Œìš”?",
                "ì œ ê²½ë ¥ ë°œì „ì— ë„ì›€ì´ ë ê¹Œìš”?",
                "ì–´ë–¤ ë¶„ì•¼ë¡œ ê°€ëŠ” ê²Œ ì¢‹ì„ì§€ ì¡°ì–¸í•´ì£¼ì‹¤ ìˆ˜ ìˆë‚˜ìš”?"
            ],
            reactions: [
                "ê·¸ëŸ° ê´€ì ì—ì„œëŠ” ìƒê° ëª»í•´ë´¤ì–´ìš”.",
                "ë„¤, ê·¸ ë¶€ë¶„ì´ ì œì¼ ì¤‘ìš”í•˜ì£ .",
                "í˜„ì‹¤ì ì¸ ì¡°ì–¸ ê°ì‚¬í•©ë‹ˆë‹¤.",
                "ê·¸ë ‡ê²Œ ì ‘ê·¼í•˜ë©´ ì¢‹ì„ ê²ƒ ê°™ë„¤ìš”.",
                "ìš©ê¸°ê°€ ìƒê¸°ëŠ” ê²ƒ ê°™ì•„ìš”."
            ]
        },
        
        health: {
            id: 'health',
            name: 'ê±´ê°•ìš´ ìƒë‹´',
            icon: 'ğŸ¥',
            description: 'ê±´ê°• ìƒíƒœ, ì£¼ì˜ì‚¬í•­',
            systemPrompt: `ë‹¹ì‹ ì€ íƒ€ë¡œ ìƒë‹´ì„ ë°›ìœ¼ëŸ¬ ì˜¨ ì¤‘ë…„ì˜ ì†ë‹˜ì…ë‹ˆë‹¤.
ìµœê·¼ ê±´ê°•ì— ëŒ€í•œ ê±±ì •ì´ ìˆê±°ë‚˜ ì£¼ì˜í•´ì•¼ í•  ì ì„ ì•Œê³  ì‹¶ì–´í•©ë‹ˆë‹¤.
ì§„ì§€í•˜ê³  ì¡°ì‹¬ìŠ¤ëŸ¬ìš´ íƒœë„ë¡œ ê±´ê°• ê´€ë ¨ ì¡°ì–¸ì„ êµ¬í•˜ì„¸ìš”.`,
            openingLines: [
                "ì•ˆë…•í•˜ì„¸ìš”, ê±´ê°•ìš´ì„ ë´ì£¼ì‹¤ ìˆ˜ ìˆì„ê¹Œìš”?",
                "ìš”ì¦˜ ëª¸ì´ ì¢€ ì•ˆ ì¢‹ì€ë°, íŠ¹ë³„íˆ ì¡°ì‹¬í•´ì•¼ í•  ê²Œ ìˆì„ê¹Œìš”?",
                "ê±´ê°• ê´€ë ¨í•´ì„œ ê¶ê¸ˆí•œ ê²Œ ìˆì–´ì„œìš”."
            ],
            followUpQuestions: [
                "íŠ¹ë³„íˆ ì£¼ì˜í•´ì•¼ í•  ë¶€ë¶„ì´ ìˆë‚˜ìš”?",
                "ê±´ê°• ê²€ì§„ì„ ë°›ì•„ì•¼ í• ê¹Œìš”?",
                "ìƒí™œ ìŠµê´€ì„ ì–´ë–»ê²Œ ë°”ê¾¸ë©´ ì¢‹ì„ê¹Œìš”?",
                "ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬ëŠ” ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œìš”?",
                "íšŒë³µë˜ëŠ” ë° ì‹œê°„ì´ ì–¼ë§ˆë‚˜ ê±¸ë¦´ê¹Œìš”?"
            ],
            reactions: [
                "ê·¸ ë¶€ë¶„ì€ ì •ë§ ì¡°ì‹¬í•´ì•¼ê² ë„¤ìš”.",
                "ì•Œë ¤ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.",
                "ê·¸ë ‡ê²Œ í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.",
                "ë§ˆìŒì´ ì¢€ ë†“ì´ë„¤ìš”.",
                "êµ¬ì²´ì ì¸ ì¡°ì–¸ì´ í° ë„ì›€ì´ ë©ë‹ˆë‹¤."
            ]
        },
        
        general: {
            id: 'general',
            name: 'ì¢…í•© ìš´ì„¸',
            icon: 'ğŸŒŸ',
            description: 'ì „ë°˜ì ì¸ ìš´ì„¸ì™€ ì¡°ì–¸',
            systemPrompt: `ë‹¹ì‹ ì€ íƒ€ë¡œ ìƒë‹´ì„ ë°›ìœ¼ëŸ¬ ì˜¨ ì¼ë°˜ ì†ë‹˜ì…ë‹ˆë‹¤.
ìš”ì¦˜ ì „ë°˜ì ìœ¼ë¡œ ê¶ê¸ˆí•œ ì ì´ ë§ê³ , ì•ìœ¼ë¡œì˜ ìš´ì„¸ê°€ ê¶ê¸ˆí•©ë‹ˆë‹¤.
ì—´ë¦° ë§ˆìŒìœ¼ë¡œ ë‹¤ì–‘í•œ ì¡°ì–¸ì„ ë“£ê³  ì‹¶ì–´í•©ë‹ˆë‹¤.`,
            openingLines: [
                "ì•ˆë…•í•˜ì„¸ìš”, ì „ë°˜ì ì¸ ìš´ì„¸ë¥¼ ë´ì£¼ì‹¤ ìˆ˜ ìˆì„ê¹Œìš”?",
                "ìš”ì¦˜ ì—¬ëŸ¬ ê°€ì§€ë¡œ ë§ˆìŒì´ ë³µì¡í•´ì„œìš”.",
                "ì•ìœ¼ë¡œ ì–´ë–»ê²Œ ë ì§€ ê¶ê¸ˆí•´ì„œ ì™”ìŠµë‹ˆë‹¤."
            ],
            followUpQuestions: [
                "ê°€ì¥ ì£¼ì˜í•´ì•¼ í•  ì ì€ ë¬´ì—‡ì¸ê°€ìš”?",
                "ì¢‹ì€ ê¸°íšŒê°€ ì˜¬ê¹Œìš”?",
                "ì œê°€ ì–´ë–¤ ë§ˆìŒê°€ì§ì„ ê°€ì ¸ì•¼ í• ê¹Œìš”?",
                "íŠ¹ë³„íˆ ì‹ ê²½ ì¨ì•¼ í•  ë¶„ì•¼ê°€ ìˆë‚˜ìš”?",
                "ê¸ì •ì ì¸ ë³€í™”ê°€ ìˆì„ê¹Œìš”?"
            ],
            reactions: [
                "ê·¸ë ‡êµ°ìš”, ì´í•´í–ˆìŠµë‹ˆë‹¤.",
                "ìƒê°í•´ë³¼ ì ì´ ë§ë„¤ìš”.",
                "ì¢‹ì€ ë§ì”€ ê°ì‚¬í•©ë‹ˆë‹¤.",
                "ë§ˆìŒì— ìƒˆê¸°ê² ìŠµë‹ˆë‹¤.",
                "í¬ë§ì ìœ¼ë¡œ ë“¤ë¦¬ë„¤ìš”."
            ]
        }
    },

    /**
     * ì‹œë‚˜ë¦¬ì˜¤ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
     */
    getScenario(scenarioId) {
        return this.scenarios[scenarioId] || null;
    },

    /**
     * ëª¨ë“  ì‹œë‚˜ë¦¬ì˜¤ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
     */
    getAllScenarios() {
        return Object.values(this.scenarios);
    },

    /**
     * ì‹œë‚˜ë¦¬ì˜¤ì˜ ì˜¤í”„ë‹ ë©˜íŠ¸ ê°€ì ¸ì˜¤ê¸°
     */
    getOpeningLine(scenarioId) {
        const scenario = this.getScenario(scenarioId);
        if (!scenario) return null;
        
        return scenario.openingLines[0];
    },

    /**
     * ëœë¤ í›„ì† ì§ˆë¬¸ ê°€ì ¸ì˜¤ê¸°
     */
    getRandomFollowUpQuestion(scenarioId) {
        const scenario = this.getScenario(scenarioId);
        if (!scenario || !scenario.followUpQuestions.length) return null;
        
        const randomIndex = Math.floor(Math.random() * scenario.followUpQuestions.length);
        return scenario.followUpQuestions[randomIndex];
    },

    /**
     * ëœë¤ ë°˜ì‘ ê°€ì ¸ì˜¤ê¸°
     */
    getRandomReaction(scenarioId) {
        const scenario = this.getScenario(scenarioId);
        if (!scenario || !scenario.reactions.length) return null;
        
        const randomIndex = Math.floor(Math.random() * scenario.reactions.length);
        return scenario.reactions[randomIndex];
    },

    /**
     * ì‹œë‚˜ë¦¬ì˜¤ë³„ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ê°€ì ¸ì˜¤ê¸°
     */
    getSystemPrompt(scenarioId) {
        const scenario = this.getScenario(scenarioId);
        if (!scenario) return '';
        
        return scenario.systemPrompt;
    },

    /**
     * ëŒ€í™” ì»¨í…ìŠ¤íŠ¸ ìƒì„±
     * @param {string} scenarioId - ì‹œë‚˜ë¦¬ì˜¤ ID
     * @param {Array} conversationHistory - ì´ì „ ëŒ€í™” ê¸°ë¡
     * @returns {string} - Gemini APIìš© í”„ë¡¬í”„íŠ¸
     */
    buildConversationContext(scenarioId, conversationHistory = []) {
        const scenario = this.getScenario(scenarioId);
        if (!scenario) return '';

        let context = scenario.systemPrompt + '\n\n';
        
        if (conversationHistory.length === 0) {
            context += 'ì²« ì¸ì‚¬ë¡œ ìƒë‹´ì„ ì‹œì‘í•˜ì„¸ìš”. ìì—°ìŠ¤ëŸ½ê³  ê°„ê²°í•˜ê²Œ í•œë‘ ë¬¸ì¥ìœ¼ë¡œ ë§í•˜ì„¸ìš”.';
        } else {
            context += 'ì´ì „ ëŒ€í™”:\n';
            conversationHistory.forEach((msg, index) => {
                const speaker = msg.role === 'client' ? 'ì†ë‹˜' : 'ê°•ì‚¬';
                context += `${speaker}: ${msg.content}\n`;
            });
            context += '\nì†ë‹˜ìœ¼ë¡œì„œ ìì—°ìŠ¤ëŸ½ê²Œ ë°˜ì‘í•˜ê±°ë‚˜ ë‹¤ìŒ ì§ˆë¬¸ì„ í•˜ì„¸ìš”. í•œë‘ ë¬¸ì¥ìœ¼ë¡œ ê°„ê²°í•˜ê²Œ ë§í•˜ì„¸ìš”.';
        }

        return context;
    },

    /**
     * ëŒ€í™” ë‹¨ê³„ íŒë‹¨
     * @param {number} messageCount - í˜„ì¬ê¹Œì§€ ë©”ì‹œì§€ ìˆ˜
     * @returns {string} - ëŒ€í™” ë‹¨ê³„ (opening, middle, closing)
     */
    getConversationStage(messageCount) {
        if (messageCount <= 2) return 'opening';
        if (messageCount <= 8) return 'middle';
        return 'closing';
    },

    /**
     * ë§ˆë¬´ë¦¬ ë©˜íŠ¸ ìƒì„±
     */
    getClosingLine(scenarioId) {
        const closingLines = [
            "ì •ë§ ê°ì‚¬í•©ë‹ˆë‹¤. ë§ì€ ë„ì›€ì´ ëì–´ìš”.",
            "ì˜¤ëŠ˜ ìƒë‹´ ë•ë¶„ì— ë§ˆìŒì´ í¸í•´ì¡ŒìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤.",
            "ì¢‹ì€ ì¡°ì–¸ ì •ë§ ê°ì‚¬ë“œë¦½ë‹ˆë‹¤.",
            "ì•ìœ¼ë¡œ ì–´ë–»ê²Œ í•´ì•¼ í• ì§€ ì•Œê²Œ ëì–´ìš”. ê°ì‚¬í•©ë‹ˆë‹¤.",
            "í° í˜ì´ ëìŠµë‹ˆë‹¤. ì •ë§ ê°ì‚¬í•´ìš”."
        ];
        
        const randomIndex = Math.floor(Math.random() * closingLines.length);
        return closingLines[randomIndex];
    }
};

// ì „ì—­ìœ¼ë¡œ export
if (typeof window !== 'undefined') {
    window.TarotScenarios = TarotScenarios;
}
